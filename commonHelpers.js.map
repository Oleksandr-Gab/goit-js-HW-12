{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport axios from 'axios';\n\n\nconst gallery = document.querySelector(\".gallery\");\nconst searchForm = document.querySelector(\".search-form\");\nconst loading = document.querySelector(\".loading\");\nconst btnLoad = document.querySelector(\".btn-load\");\nconst btnLoadDiv = document.querySelector(\".btn-load-div\")\n\nconst api = axios.create({\n  baseURL: 'https://pixabay.com/api/',\n  params: {\n    key: \"41686068-f8a1ddec694d7ca7a5960473b\",\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n  }\n});\n\nfunction renderHits(hits = []) {\n  const renderImg = hits.reduce((html, {largeImageURL, webformatURL, tags, likes, views, comments, downloads}) => {\n      return (\n        html +\n        `<li class=\"gallery-item\">\n    <a href=${largeImageURL}> \n      <img class=\"gallery-img\" src =${webformatURL} alt=${tags}/>\n    </a>\n    <div class=\"gallery-text-box\">\n      <p>Likes: <span class=\"text-value\">${likes}</span></p>\n      <p>views: <span class=\"text-value\">${views}</span></p>\n      <p>comments: <span class=\"text-value\">${comments}</span></p>\n      <p>downloads: <span class=\"text-value\">${downloads}</span></p>\n  </div>\n  </li>`\n      );\n    }, '');  \n  gallery.insertAdjacentHTML(\"beforeend\", renderImg);\n  lightbox.refresh();\n}\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  nav: true,\n  captionDelay: 250,\n  captionsData: 'alt',\n  close: true,\n  enableKeyboard: true,\n  docClose: true,\n});\n\nconst getHits = async (params) => {\n  try {  \n    const response = await api.get(\"\", { params });\n    return response.data;\n  } catch(error) {\n    console.error(error);\n  } \n}\n\nconst createGetHitsRequest = (q) => {\n  let page = 1;\n  let isLastPage = false;\n  const per_page = 40;\n\n  return async () => {\n    try {\n      if (isLastPage) return;\n      const { hits, totalHits } = await getHits({ page, per_page, q });\n      if (page >= Math.ceil( totalHits / per_page)) {\n        isLastPage = true;\n      }\n      page++;\n      if (isLastPage && totalHits != 0) {\n        btnLoadDiv.classList.add('is-hidden');\n        messageInfo();\n      }\n      if (totalHits == 0) {\n        btnLoadDiv.classList.add('is-hidden');\n        messageError();\n      }\n      return hits;\n    } catch(error) {\n      console.error(error);\n    }\n  };\n}\n\nlet doFetch = null;\nlet goScroll = null;\n\nsearchForm.addEventListener(\"submit\", async (event) => {\n  event.preventDefault();\n  \n  if (doFetch != null) {\n    btnLoad.removeEventListener(\"click\", goScroll);\n    doFetch = null;\n  }\n\n  const data = new FormData(event.currentTarget);\n  const search = data.get(\"search\").trim();\n  gallery.innerHTML = \"\";\n  btnLoadDiv.classList.add('is-hidden');\n  if (!search) {\n    messageWarning()\n    return;\n  }\n  btnLoadDiv.classList.remove('is-hidden');\n    const fetchHits = createGetHitsRequest(search);\n  event.currentTarget.reset();\n  doFetch = async () => {\n    const articles = await makePromiseWithSpinner({\n      promise: fetchHits,\n      spinner: loading,\n    })\n    \n    renderHits(articles);\n  }\n\n  await makePromiseWithSpinner({\n    promise: doFetch,\n    spinner: loading,\n  });\n\n  goScroll = async () => {\n    await scroll ({promise: doFetch})\n  }\n\n  btnLoad.addEventListener('click', goScroll);\n  });\n\n\nconst makePromiseWithSpinner = async ({ promise, spinner, className = 'is-hidden' }) => {\n  spinner.classList.remove(className);\n  btnLoad.classList.add(className);\n\n  const response = await promise();\n\n  spinner.classList.add(className);\n  btnLoad.classList.remove(className);\n  return response;\n};\n\nconst scroll = async ({ promise }) => {\n  const imgItem = document.querySelector('.gallery-item')\n  const dataImgItem = imgItem.getBoundingClientRect().height;\n  const viewportHeight = document.documentElement.clientHeight;\n\n    const response = await promise();\n    window.scrollBy({\n    top: dataImgItem*Math.floor(viewportHeight/dataImgItem),\n    left: 0,\n    behavior: \"smooth\",\n  });\n  }\n\n  const messageWarning = () => iziToast.warning({\n    position: 'topRight',\n    message:\n      'Please, fill in the field!',\n  });\n  \n  const messageInfo = () => iziToast.info({\n    position: 'topRight',\n    message:\n    \"We're sorry, but you've reached the end of search results.\",\n  });\n  \n  const messageError = () => iziToast.error({\n    position: 'topRight',\n    message:\n      'Sorry, there are no images matching your search query. Please try again!',\n  });\n"],"names":["gallery","searchForm","loading","btnLoad","btnLoadDiv","api","axios","renderHits","hits","renderImg","html","largeImageURL","webformatURL","tags","likes","views","comments","downloads","lightbox","SimpleLightbox","getHits","params","error","createGetHitsRequest","q","page","isLastPage","per_page","totalHits","messageInfo","messageError","doFetch","goScroll","event","search","messageWarning","fetchHits","articles","makePromiseWithSpinner","scroll","promise","spinner","className","response","dataImgItem","viewportHeight","iziToast"],"mappings":"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"}