{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport axios from 'axios';\n\n\nconst api = axios.create({\n  baseURL: 'https://pixabay.com/api/',\n  params: {\n    key: \"41686068-f8a1ddec694d7ca7a5960473b\",\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n  }\n});\n\nconst messageWarning = () => iziToast.warning({\n  position: 'topRight',\n  message:\n    'Please, fill in the field!',\n});\n\nconst messageError = () => iziToast.error({\n            position: 'topRight',\n            message:\n              'Sorry, there are no images matching your search query. Please try again!',\n          });\n\nconst gallery = document.querySelector(\".gallery\");\nconst searchForm = document.querySelector(\".search-form\");\nconst loading = document.querySelector(\".loading\");\nconst btnLoad = document.querySelector(\".btn-load\")\n\nfunction renderHits(hits = []) {\n  const renderImg = hits.reduce((html, {largeImageURL, webformatURL, tags, likes, views, comments, downloads}) => {\n      return (\n        html +\n        `<li class=\"gallery-item\">\n    <a href=${largeImageURL}> \n      <img class=\"gallery-img\" src =${webformatURL} alt=${tags}/>\n    </a>\n    <div class=\"gallery-text-box\">\n      <p>Likes: <span class=\"text-value\">${likes}</span></p>\n      <p>views: <span class=\"text-value\">${views}</span></p>\n      <p>comments: <span class=\"text-value\">${comments}</span></p>\n      <p>downloads: <span class=\"text-value\">${downloads}</span></p>\n  </div>\n  </li>`\n      );\n    }, '');  \n    \n  gallery.insertAdjacentHTML(\"beforeend\", renderImg);\n  lightbox.refresh();\n}\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  nav: true,\n  captionDelay: 250,\n  captionsData: 'alt',\n  close: true,\n  enableKeyboard: true,\n  docClose: true,\n});\n\n\nconst getHits = async (params) => {\n  try {  \n    const response = await api.get(\"\", { params });\n    return response.data;\n  } catch(error) {\n    console.error(error);\n  } \n}\n\n\n\nconst createGetHitsRequest = (q) => {\n  let page = 1;\n  let isLastPage = false;\n  const per_page = 40;\n\n  return async () => {\n    try {\n      if (isLastPage) return;\n      const { hits, totalHits } = await getHits({ page, per_page, q });\n      if (page >= Math.ceil( totalHits / per_page)) {\n        isLastPage = true;\n      }\n      \n      page++;\n\n      if (isLastPage) {btnLoad.style.display = \"none\"}\n      if (hits.length == 0) {\n        messageError();\n        return;\n      }\n      return hits;\n    } catch(error) {\n      console.error(error);\n    }\n  };\n}\n\nlet doFetch = null;\n\nsearchForm.addEventListener(\"submit\", async (event) => {\n  event.preventDefault();\n\n  if (doFetch != null) {\n    btnLoad.removeEventListener(\"click\", doFetch);\n    doFetch = null;\n  }\n \n  const data = new FormData(event.currentTarget);\n  const search = data.get(\"search\");\n  if (!search) {\n    messageWarning()\n    return;\n  }\n  gallery.innerHTML = \"\";\n  btnLoad.style.display = \"block\";\n  const fetchHits = createGetHitsRequest(search);\n  event.currentTarget.reset();\n  doFetch = async () => {\n    const articles = await makePromiseWithSpinner({\n      promise: fetchHits,\n      spinner: loading,\n    })\n\n    renderHits(articles);\n  }\n\n  await makePromiseWithSpinner({\n    promise: doFetch,\n    spinner: loading,\n  });\n  btnLoad.addEventListener('click', doFetch);\n});\n\n\nconst makePromiseWithSpinner = async ({ promise, spinner, className = 'is-hidden' }) => {\n  spinner.classList.remove(className);\n  btnLoad.classList.add(className);\n\n  const response = await promise();\n\n  spinner.classList.add(className);\n  btnLoad.classList.remove(className);\n\n  return response;\n};\n"],"names":["api","axios","messageWarning","iziToast","messageError","gallery","searchForm","loading","btnLoad","renderHits","hits","renderImg","html","largeImageURL","webformatURL","tags","likes","views","comments","downloads","lightbox","SimpleLightbox","getHits","params","error","createGetHitsRequest","q","page","isLastPage","per_page","totalHits","doFetch","event","search","fetchHits","articles","makePromiseWithSpinner","promise","spinner","className","response"],"mappings":"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"}